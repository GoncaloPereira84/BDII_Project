{% extends "masterPage.html" %}

{% block title %}
Listar
{% endblock %}
{% load static %}
{% block links %}
<link rel="stylesheet" href="{% static 'assets/js/plugins/datatables-bs5/css/dataTables.bootstrap5.min.css'%}">
<link rel="stylesheet" href="{% static 'assets/js/plugins/datatables-buttons-bs5/css/buttons.bootstrap5.min.css'%}">

{% endblock %}

{% block content %}
<div class="content">
  <div class="block block-rounded">
    {% if table_name == "compra" %}
    <a href="/order/create/" class="btn btn-success mb-3 m-3 float-end"><i class="fa fa-fw fa-plus"></i>Nova
      encomenda</a>
    {% endif %}
    {% if table_name == "equipamento" %}
    <a href="/equipamento/create/" class="btn btn-success mb-3 m-3 float-end"><i class="fa fa-fw fa-plus"></i>Novo
      equipamento</a>
    {% endif %}
    <div class="block-header block-header-default">
      <h3 class="block-title">{{ table_name }}</small></h3>
    </div>
    <div class="block-content block-content-full">
      <table class="table table-bordered table-striped table-vcenter js-dataTable-full">
        <thead>
          <tr>
            {% for column in columns %}
            <th class="d-none d-sm-table-cell">{{ column }}</th>
            {% endfor %}
            <th class="d-none d-sm-table-cell">actions</th>
          </tr>
        </thead>
        <tbody>
          {% for row in table_data %}
          <tr>
            {% if imagem_column_present and row.0 != 0 %}
            <td><img src="{{ row.0 }}" alt="Image" style="max-width: 40px; max-height: 40px;"></td>
            {% endif %}
            {% for i in row %}
            {% if forloop.first and imagem_column_present %}
            {% comment %} Skip the first iteration because image exits {% endcomment %}
            {% else %}
            <td>{{ i }}</td>
            {% endif %}
            {% endfor %}
            <td class="text-center d-flex align-items-center justify-content-center">
              {% if imagem_column_present %}
              <form method="post" action="{% url 'edit_record' table_name=table_name record_id=row.1 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-alt-secondary" data-bs-toggle="tooltip" title="Edit">
                  <i class="fa fa-pencil-alt"></i>
                </button>
              </form>
              <button type="button" class="btn btn-sm btn-alt-secondary ms-1" data-bs-toggle="tooltip" title="Delete"
                onclick="confirmDelete('{{ table_name }}', '{{ row.1 }}')">
                <i class="fa fa-times"></i>
              </button>
              {% else %}
              <form method="post" action="{% url 'edit_record' table_name=table_name record_id=row.0 %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-alt-secondary" data-bs-toggle="tooltip" title="Edit">
                  <i class="fa fa-pencil-alt"></i>
                </button>
              </form>
              <button type="button" class="btn btn-sm btn-alt-secondary ms-1" data-bs-toggle="tooltip" title="Delete"
                onclick="confirmDelete('{{ table_name }}', '{{ row.0 }}')">
                <i class="fa fa-times"></i>
              </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function confirmDelete(tableName, recordId) {
    if (confirm('Tem certeza de que deseja excluir este registro?')) {
      window.location.href = `/delete_record/${tableName}/${recordId}/`;
    }
  }
</script>

<!-- jQuery (required for DataTables plugin) -->
<script src="{% static 'assets/js/lib/jquery.min.js'%}"></script>

<!-- Page JS Plugins -->
<script src="{% static 'assets/js/plugins/datatables/jquery.dataTables.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-bs5/js/dataTables.bootstrap5.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons/dataTables.buttons.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons-bs5/js/buttons.bootstrap5.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons-jszip/jszip.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons-pdfmake/pdfmake.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons-pdfmake/vfs_fonts.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons/buttons.print.min.js'%}"></script>
<script src="{% static 'assets/js/plugins/datatables-buttons/buttons.html5.min.js'%}"></script>

<script src="{% static 'assets/js/pages/be_tables_datatables.min.js'%}"></script>

{% endblock %}